<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Uploading Custom Dataset to HuggingFace with Croissant Metafile | Sidong Zhang</title> <meta name="author" content="Sidong Zhang"> <meta name="description" content="Hi this is Sidong (or you can just call me Stone). I am recording my research projects, ideas and learning notes in this website. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/infofusion.png?5c67728fce50989ea09210456b6a4e07"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://stonezhng.github.io/blog/2025/Uploading-Custom-Dataset-to-HuggingFace-with-Croissant-Metafile/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">SidongÂ </span>Zhang</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Uploading Custom Dataset to HuggingFace with Croissant Metafile</h1> <p class="post-meta">May 12, 2025</p> <p class="post-tags"> <a href="/blog/2025"> <i class="fas fa-calendar fa-sm"></i> 2025 </a> Â  Â· Â  <a href="/blog/tag/huggingface"> <i class="fas fa-hashtag fa-sm"></i> HuggingFace</a> Â  <a href="/blog/tag/croissant"> <i class="fas fa-hashtag fa-sm"></i> Croissant</a> Â  Â  Â· Â  <a href="/blog/category/coding"> <i class="fas fa-tag fa-sm"></i> coding</a> Â  </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="why-this-matters">Why this Matters</h1> <p>HuggingFace has a whole system to reformat the uploaded dataset. If you do not follow it you bascially can just use it like an online drive, but if you follow all the requirements to upload your dataset formally it can basically automatically convert your data to parquet format, and generate a fancy dataset card, as well as the croissant metafile, as the meta information of the dataset.</p> <p>I want to use the ImageFolder format from the two formats supported by HuggingFace. However, when searching on how to do this from scratch I do feel the offical tutorials are quite limited, like the examples are mostly about data of strings or images. It is 2025 and many are using preprocessed features from the raw data, so the inputs may be just a 512 or 768 dim vector. Instructions on uploading these types of data are not that clear so I write to record my own experience. My final uploaded dataset can be found here: <a href="https://huggingface.co/datasets/stonezh/PairedMNIST" rel="external nofollow noopener" target="_blank">https://huggingface.co/datasets/stonezh/PairedMNIST</a></p> <h1 id="local-file-structure">Local File Structure</h1> <p>Let us assume the local file is organized in this way:</p> <p>ğŸ“ test<br> â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label1.npy<br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”œâ”€â”€ img0.npy  
â”œâ”€â”€ img1.npy  
â””â”€â”€ ...    ğŸ“ train   â”œâ”€â”€ ğŸ“ first_img   â”‚   â”œâ”€â”€ img0.npy   â”‚   â”œâ”€â”€ img1.npy   â”‚   â””â”€â”€ ...   â”œâ”€â”€ ğŸ“ label   â”‚   â”œâ”€â”€ label0.npy   â”‚   â”œâ”€â”€ label1.npy   â”‚   â””â”€â”€ ...   â”œâ”€â”€ ğŸ“„ metadata.jsonl   â”œâ”€â”€ ğŸ“ second_img 

â”œâ”€â”€ img0.npy  
â”œâ”€â”€ img1.npy  
â””â”€â”€ ...   ğŸ“ val  â”œâ”€â”€ ğŸ“ first_img   â”‚   â”œâ”€â”€ img0.npy   â”‚   â”œâ”€â”€ img1.npy   â”‚   â””â”€â”€ ...   â”œâ”€â”€ ğŸ“ label   â”‚   â”œâ”€â”€ label0.npy   â”‚   â”œâ”€â”€ label1.npy   â”‚   â””â”€â”€ ...   â”œâ”€â”€ ğŸ“„ metadata.jsonl   â”œâ”€â”€ ğŸ“ second_img 

â”œâ”€â”€ img0.npy  
â”œâ”€â”€ img1.npy  
â””â”€â”€ ...  
</code></pre></div></div> <p>This is the backbone structure of ImageFolder. The data itself is basically just MNIST with two images, and label being the multiplication of the two figures in the two images, but instead of assuming the image is an image and the label is a label, I d rather just treat them as an 1D vector, as if they are preprocessed latent features. So each imgX.npy is just a 784 dim vector, and each label is just a 1 dim vector.</p> <h1 id="step-1-create-local-metafile">Step 1: Create Local Metafile</h1> <p>Just write a local python script to scan the files and get a meta file. I recommend using <code class="language-plaintext highlighter-rouge">jsonlines</code> package to save the metafile as <code class="language-plaintext highlighter-rouge">.jsonl</code> file. Suppose we call the metafile as <code class="language-plaintext highlighter-rouge">metafile.jsonl</code> (name does not matter you can name it anything you like), it should look like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"first_img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"first_img/img0.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"second_img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"second_img/img0.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"label/label0.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"this is the 0th sample"</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"first_img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"first_img/img1.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"second_img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"second_img/img1.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"label/label1.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"this is the 1th sample"</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"first_img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"first_img/img2.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"second_img"</span><span class="p">:</span><span class="w"> </span><span class="s2">"second_img/img2.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"label/label2.npy"</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"this is the 2th sample"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>The folder now should look like this</p> <p>ğŸ“ test<br> â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy <br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label0.npy <br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img<br> â”œâ”€â”€ img0.npy<br> â”œâ”€â”€ img1.npy <br> â””â”€â”€ â€¦<br> ğŸ“ train<br> â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy <br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label0.npy <br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img<br> â”œâ”€â”€ img0.npy<br> â”œâ”€â”€ img1.npy <br> â””â”€â”€ â€¦<br> ğŸ“ val â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy <br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label0.npy <br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img<br> â”œâ”€â”€ img0.npy<br> â”œâ”€â”€ img1.npy <br> â””â”€â”€ â€¦</p> <h1 id="write-custom-datasetgeneratorbasedbuilder">Write Custom dataset.GeneratorBasedBuilder</h1> <p>Under each folder (train, val, test), put a corresponding python file named train.py, val.py and test.py respectively. For test.py it looks like</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">huggingface_hub</span> <span class="kn">import</span> <span class="n">hf_hub_url</span>
<span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>


<span class="n">METADATA_URL</span> <span class="o">=</span> <span class="nf">hf_hub_url</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">stonezh/PairedMNIST</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="sh">"</span><span class="s">metadata.jsonl</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">repo_type</span><span class="o">=</span><span class="sh">"</span><span class="s">dataset</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">_DESCRIPTION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">TODO</span><span class="sh">"</span>
<span class="n">_HOMEPAGE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">NONE</span><span class="sh">"</span>
<span class="n">_LICENSE</span> <span class="o">=</span> <span class="sh">"</span><span class="s">NONE</span><span class="sh">"</span>
<span class="n">_CITATION</span> <span class="o">=</span> <span class="sh">"</span><span class="s">NONE</span><span class="sh">"</span>

<span class="c1"># _FEATURES = datasets.Features(
#     {
#         "first_image": datasets.Sequence(datasets.Value("float64"), length=784),  # https://discuss.huggingface.co/t/setting-dataset-feature-value-as-numpy-array/20940/2
#         "second_image": datasets.Sequence(datasets.Value("float64"), length=784),
#         "label": datasets.Sequence(datasets.Value("float64"), length=1)
#     },
# )
</span>
<span class="n">_FEATURES</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">.</span><span class="nc">Features</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">first_image</span><span class="sh">"</span><span class="p">:</span> <span class="n">datasets</span><span class="p">.</span><span class="nc">Array2D</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">'</span><span class="s">float64</span><span class="sh">'</span><span class="p">),</span>  <span class="c1"># https://discuss.huggingface.co/t/setting-dataset-feature-value-as-numpy-array/20940/2
</span>        <span class="sh">"</span><span class="s">second_image</span><span class="sh">"</span><span class="p">:</span>  <span class="n">datasets</span><span class="p">.</span><span class="nc">Array2D</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">'</span><span class="s">float64</span><span class="sh">'</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span>  <span class="n">datasets</span><span class="p">.</span><span class="nc">Array2D</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="sh">'</span><span class="s">float64</span><span class="sh">'</span><span class="p">)</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="c1"># _FEATURES = datasets.Features(
#     {
#         "first_image": datasets.Image,  # https://discuss.huggingface.co/t/setting-dataset-feature-value-as-numpy-array/20940/2
#         "second_image": datasets.Image,
#         "label": datasets.Image
#     },
# )
</span>
<span class="n">_DEFAULT_CONFIG</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">.</span><span class="nc">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">datasets</span><span class="p">.</span><span class="nc">Version</span><span class="p">(</span><span class="sh">"</span><span class="s">0.0.1</span><span class="sh">"</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">PairedMNIST</span><span class="p">(</span><span class="n">datasets</span><span class="p">.</span><span class="n">GeneratorBasedBuilder</span><span class="p">):</span>
    <span class="n">BUILDER_CONFIGS</span> <span class="o">=</span> <span class="p">[</span><span class="n">_DEFAULT_CONFIG</span><span class="p">]</span>
    <span class="n">DEFAULT_CONFIG_NAME</span> <span class="o">=</span> <span class="sh">"</span><span class="s">default</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datasets</span><span class="p">.</span><span class="nc">DatasetInfo</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="n">_DESCRIPTION</span><span class="p">,</span>
            <span class="n">features</span><span class="o">=</span><span class="n">_FEATURES</span><span class="p">,</span>
            <span class="n">supervised_keys</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">homepage</span><span class="o">=</span><span class="n">_HOMEPAGE</span><span class="p">,</span>
            <span class="n">license</span><span class="o">=</span><span class="n">_LICENSE</span><span class="p">,</span>
            <span class="n">citation</span><span class="o">=</span><span class="n">_CITATION</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_split_generators</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dl_manager</span><span class="p">):</span>
        <span class="c1"># print(dl_manager._data_dir)
</span>        <span class="c1"># metadata_path = os.path.join(dl_manager._data_dir, "metadata.jsonl")
</span>        <span class="c1"># first_img_path = os.path.join(dl_manager._data_dir, "first_img")
</span>        <span class="c1"># second_img_path = os.path.join(dl_manager._data_dir, "second_img")
</span>        <span class="c1"># label_path = os.path.join(dl_manager._data_dir, "label")
</span>
        <span class="n">metadata_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">dl_manager</span><span class="p">.</span><span class="n">_data_dir</span><span class="p">,</span> <span class="sh">"</span><span class="s">metadata.jsonl</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">first_img_path</span> <span class="o">=</span> <span class="n">dl_manager</span><span class="p">.</span><span class="n">_data_dir</span>
        <span class="n">second_img_path</span> <span class="o">=</span> <span class="n">dl_manager</span><span class="p">.</span><span class="n">_data_dir</span>
        <span class="n">label_path</span> <span class="o">=</span> <span class="n">dl_manager</span><span class="p">.</span><span class="n">_data_dir</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">datasets</span><span class="p">.</span><span class="nc">SplitGenerator</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">datasets</span><span class="p">.</span><span class="n">Split</span><span class="p">.</span><span class="n">TEST</span><span class="p">,</span>
                <span class="c1"># These kwargs will be passed to _generate_examples
</span>                <span class="n">gen_kwargs</span><span class="o">=</span><span class="p">{</span>
                    <span class="sh">"</span><span class="s">metadata_path</span><span class="sh">"</span><span class="p">:</span> <span class="n">metadata_path</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">first_img_path</span><span class="sh">"</span><span class="p">:</span> <span class="n">first_img_path</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">second_img_path</span><span class="sh">"</span><span class="p">:</span> <span class="n">second_img_path</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">label_path</span><span class="sh">"</span><span class="p">:</span> <span class="n">label_path</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_generate_examples</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">metadata_path</span><span class="p">,</span> <span class="n">first_img_path</span><span class="p">,</span> <span class="n">second_img_path</span><span class="p">,</span> <span class="n">label_path</span><span class="p">):</span>
        <span class="c1"># print(metadata_path)
</span>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_json</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">():</span>
            <span class="n">cur_first_img_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">first_img_path</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="sh">"</span><span class="s">first_img</span><span class="sh">"</span><span class="p">])</span>
            <span class="c1"># cur_first_img_path = row["first_img"]
</span>            <span class="n">first_img</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">cur_first_img_path</span><span class="p">).</span><span class="nf">tolist</span><span class="p">())</span>
            <span class="c1"># first_img = open(cur_first_img_path, "rb").read()
</span>
            <span class="n">cur_second_img_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">second_img_path</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="sh">"</span><span class="s">second_img</span><span class="sh">"</span><span class="p">])</span>
            <span class="c1"># cur_second_img_path = row["second_img"]
</span>            <span class="n">second_img</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">cur_second_img_path</span><span class="p">).</span><span class="nf">tolist</span><span class="p">())</span>
            <span class="c1"># second_img = open(cur_second_img_path, "rb").read()
</span>
            <span class="n">cur_label_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">label_path</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">])</span>
            <span class="c1"># cur_label_path = row["label"]
</span>            <span class="n">label</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">cur_label_path</span><span class="p">).</span><span class="nf">item</span><span class="p">()])</span>
            <span class="c1"># label = open(cur_label_path, "rb").read()
</span>
            <span class="c1"># return key and value pair
</span>            <span class="k">yield</span> <span class="n">row_idx</span><span class="p">,</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">first_image</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1"># "path": cur_first_img_path,
</span>                    <span class="c1"># "bytes": first_img
</span>                    <span class="n">first_img</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">second_image</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1"># "path": cur_second_img_path,
</span>                    <span class="c1"># "bytes": second_img,
</span>                    <span class="n">second_img</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1"># "path": cur_label_path,
</span>                    <span class="c1"># "bytes": label
</span>                    <span class="n">label</span>
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div></div> <p>In the other two files, change <code class="language-plaintext highlighter-rouge">name=datasets.Split.TEST</code> in <code class="language-plaintext highlighter-rouge">_split_generators</code> function to <code class="language-plaintext highlighter-rouge">name=datasets.Split.TRAIN</code> and <code class="language-plaintext highlighter-rouge">name=datasets.Split.VALIDATION</code>.</p> <p>Some explanation</p> <ul> <li>in <code class="language-plaintext highlighter-rouge">_FEATURES</code> I define all the three to be <code class="language-plaintext highlighter-rouge">datasets.Array2D</code>, simply because there is no datasets.Array1D and idk why â€¦</li> <li>in <code class="language-plaintext highlighter-rouge">_generate_examples</code> each np array is wrapped by <code class="language-plaintext highlighter-rouge">tuple(..tolist())</code>, because HuggingFace expect this function to return a hashable value in each dict value, so neither np.array nor list can be processed, and converting it to tuple is the only way I can think of. Many tutorials use bytes but that seems to work when you set <code class="language-plaintext highlighter-rouge">datasets.Image</code> in <code class="language-plaintext highlighter-rouge">_FEATURES</code>, and that is exactly what I try to avoid</li> </ul> <p>Now the structure should look like this</p> <p>ğŸ“ test<br> â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label1.npy<br> â”‚ â””â”€â”€ â€¦ â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦ <br> â””â”€â”€ ğŸ“„ test.py<br> ğŸ“ train<br> â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label1.npy<br> â”‚ â””â”€â”€ â€¦ â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦ <br> â””â”€â”€ ğŸ“„ train.py<br> ğŸ“ val</p> <p>â”œâ”€â”€ ğŸ“ first_img<br> â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦<br> â”œâ”€â”€ ğŸ“ label<br> â”‚ â”œâ”€â”€ label0.npy<br> â”‚ â”œâ”€â”€ label1.npy<br> â”‚ â””â”€â”€ â€¦ â”œâ”€â”€ ğŸ“„ metadata.jsonl<br> â”œâ”€â”€ ğŸ“ second_img â”‚ â”œâ”€â”€ img0.npy<br> â”‚ â”œâ”€â”€ img1.npy<br> â”‚ â””â”€â”€ â€¦ <br> â””â”€â”€ ğŸ“„ val.py</p> <h1 id="upload-the-data">Upload the Data</h1> <p>First some environment settings:</p> <ul> <li><code class="language-plaintext highlighter-rouge">pip install huggingface_hub</code></li> <li><code class="language-plaintext highlighter-rouge">pip install datasets</code></li> </ul> <p>Then follow the instruction here to login:</p> <p>https://huggingface.co/docs/datasets/en/upload_dataset</p> <p>using <code class="language-plaintext highlighter-rouge">huggingface-cli login</code> and your access tokens.</p> <p>Then, suppose all the three folders are in a folder named <code class="language-plaintext highlighter-rouge">paired_mnist</code>. In this <code class="language-plaintext highlighter-rouge">paired_mnist</code> folder run the following script:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">from</span> <span class="n">datasets</span> <span class="kn">import</span> <span class="n">DatasetDict</span>

<span class="n">ddict</span> <span class="o">=</span> <span class="nc">DatasetDict</span><span class="p">({</span><span class="sh">"</span><span class="s">train</span><span class="sh">"</span><span class="p">:</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">train</span><span class="sh">"</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="sh">"</span><span class="s">train</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">train</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">val</span><span class="sh">"</span><span class="p">:</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">val</span><span class="sh">"</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="sh">"</span><span class="s">val</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">validation</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">:</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">]})</span>

<span class="n">ddict</span><span class="p">.</span><span class="nf">push_to_hub</span><span class="p">(</span><span class="sh">"</span><span class="s">stonezh/PairedMNIST</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># &lt;- I am using my online repo id here
</span></code></pre></div></div> <h1 id="reference">Reference</h1> <ul> <li> <a href="https://huggingface.co/docs/datasets/en/about_dataset_features" rel="external nofollow noopener" target="_blank">https://huggingface.co/docs/datasets/en/about_dataset_features</a> : Official explanation on types of data features suppported by HuggingFace</li> <li> <a href="https://huggingface.co/docs/datasets/en/image_dataset" rel="external nofollow noopener" target="_blank">https://huggingface.co/docs/datasets/en/image_dataset</a> : HuggingFace official image dataset creation tutorial, helpful if you are uploading raw images, but if uploading just latent features then <code class="language-plaintext highlighter-rouge">datasets.Image()</code> does not work</li> <li> <a href="https://huggingface.co/docs/datasets/en/dataset_script" rel="external nofollow noopener" target="_blank">https://huggingface.co/docs/datasets/en/dataset_script</a> : Another official one making string dataset.</li> <li> <a href="https://huggingface.co/datasets/fusing/fill50k/blob/main/fill50k.py" rel="external nofollow noopener" target="_blank">https://huggingface.co/datasets/fusing/fill50k/blob/main/fill50k.py</a> : A nonoffical HuggingFace dataset with uploading codes</li> <li> <a href="http://github.com/huggingface/diffusers/issues/6077" rel="external nofollow noopener" target="_blank">http://github.com/huggingface/diffusers/issues/6077</a> : Github discussion based on the previous dataset</li> <li> <a href="https://github.com/huggingface/datasets/blob/main/templates/new_dataset_script.py" rel="external nofollow noopener" target="_blank">https://github.com/huggingface/datasets/blob/main/templates/new_dataset_script.py</a> : Official Github repo making string dataset</li> <li> <a href="https://discuss.huggingface.co/t/pushing-multiple-splits-of-dataset-to-a-single-repo-of-hub/15526" rel="external nofollow noopener" target="_blank">https://discuss.huggingface.co/t/pushing-multiple-splits-of-dataset-to-a-single-repo-of-hub/15526</a> : How to upload multiple splits in one <code class="language-plaintext highlighter-rouge">push_to_hub</code> function call. If you do it separately, like using 3 <code class="language-plaintext highlighter-rouge">push_to_hub</code> function calls for the train/val/test split, the later one just overwrite the previous one so you can only get one split in the endâ€¦</li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/flows/">Introduction to Normalizing Flows</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/PaperReviewingSelf-SupervisedLearningwithKernelDependenceMaximization/">Paper Reviewing - Self-Supervised Learning with Kernel Dependence Maximization</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/SequentialLMM/">Reviewing the paper Longitudinal data analysis using matrix completion</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/generalized-function/">Generalized funtions</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/adam-may-update-frozen-param/">Pytorch Adam may update frozen parameters</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2025 Sidong Zhang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>